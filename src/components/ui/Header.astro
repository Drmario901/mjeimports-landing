---
import {
  Home,
  Users,
  Briefcase,
  HelpCircle,
  Mail,
  Menu,
  X
} from '@lucide/astro';

const navLinks = [
  { label: 'Inicio', href: '#inicio', icon: Home },
  { label: 'Servicios', href: '#servicios', icon: Briefcase },
  { label: 'Quiénes Somos', href: '#quienes-somos', icon: Users },
  { label: 'Cómo Funciona', href: '#como-funciona', icon: HelpCircle },
  { label: 'Contacto', href: '#contact', icon: Mail },
];
---

<header class="bg-white/90 backdrop-blur-md shadow-md z-50 w-full fixed top-0 left-0 transition-all duration-300">
  <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
    <div class="flex items-center">
      <img src="/logo.png" alt="Logo MJE Imports" class="h-14 w-auto" />
    </div>

    <nav class="hidden lg:flex space-x-2 items-center">
      {navLinks.map(({ href, label, icon: Icon }) => (
        <a
          href={href}
          class="nav-link px-3 py-2 rounded-xl text-sm font-medium flex items-center gap-1 
                 transition-all duration-200 hover:bg-[#002f6c]/10 hover:text-[#002f6c]
                 hover:scale-[1.05]"
        >
          <Icon size={18} style="color: #002f6c" />
          {label}
        </a>
      ))}
    </nav>

    <button id="menu-toggle" class="lg:hidden p-2 rounded-md hover:bg-gray-100 transition relative z-[60]">
      <Menu id="menu-icon" size={28} style="color: #002f6c" />
      <X id="close-icon" size={28} style="color: #002f6c; display: none;" />
    </button>
  </div>

  <nav id="mobile-menu"
    class="lg:hidden absolute top-full left-0 w-full bg-white/95 backdrop-blur-md border-t border-gray-200 
           shadow-md opacity-0 transform -translate-y-4 pointer-events-none transition-all duration-300 z-50">
    {navLinks.map(({ href, label, icon: Icon }) => (
      <a
        href={href}
        class="nav-link px-6 py-3 text-sm font-medium flex items-center gap-2 
               transition-all duration-300 hover:bg-[#002f6c]/10 hover:text-[#002f6c] active:scale-[0.98]"
      >
        <Icon size={18} style="color: #002f6c" />
        {label}
      </a>
    ))}
  </nav>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('section[id]');
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    menuToggle.addEventListener('click', () => {
      const isOpen = !mobileMenu.classList.contains('pointer-events-none');
      if (isOpen) {
        mobileMenu.classList.add('opacity-0', '-translate-y-4', 'pointer-events-none');
        menuIcon.style.display = 'block';
        closeIcon.style.display = 'none';
      } else {
        mobileMenu.classList.remove('opacity-0', '-translate-y-4', 'pointer-events-none');
        menuIcon.style.display = 'none';
        closeIcon.style.display = 'block';
      }
    });

    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth < 1024) {
          mobileMenu.classList.add('opacity-0', '-translate-y-4', 'pointer-events-none');
          menuIcon.style.display = 'block';
          closeIcon.style.display = 'none';
        }
      });
    });

    function setActiveLink(href) {
      navLinks.forEach((link) => {
        const isActive = link.getAttribute('href') === href;
        link.classList.toggle('bg-[#002f6c]/10', isActive);
        link.classList.toggle('text-[#002f6c]', isActive);
        link.classList.toggle('font-semibold', isActive);
        link.classList.toggle('shadow-md', isActive);

        if (isActive) {
          link.classList.add('scale-[1.05]');
          setTimeout(() => link.classList.remove('scale-[1.05]'), 200);
        }
      });
    }

    const hash = window.location.hash;
    if (hash) {
      setActiveLink(hash);
      const target = document.querySelector(hash);
      if (target) {
        setTimeout(() => {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 400);
      }
    } else {
      setActiveLink('#inicio');
    }

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            setActiveLink(`#${id}`);
            history.replaceState(null, '', `#${id}`);
          }
        });
      },
      { threshold: 0.4 }
    );

    sections.forEach((section) => observer.observe(section));

    navLinks.forEach((link) => {
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        if (href.startsWith('#')) {
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            history.replaceState(null, '', href);
            setActiveLink(href);
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      });
    });
  });
</script>
