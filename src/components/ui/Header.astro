---
import {
  Home,
  Users,
  Briefcase,
  HelpCircle,
  Mail,
  Menu
} from '@lucide/astro';

const navLinks = [
  { label: 'Inicio', href: '#inicio', icon: Home },
  { label: 'Servicios', href: '#servicios', icon: Briefcase },
  { label: 'Quiénes Somos', href: '#quienes-somos', icon: Users },
  { label: 'Cómo Funciona', href: '#como-funciona', icon: HelpCircle },
  { label: 'Contacto', href: '#contact', icon: Mail },
];
---

<header class="bg-white shadow-md z-50 w-full fixed top-0 left-0">
  <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">

    <div class="flex items-center">
      <img src="/logo.png" alt="Logo MJE Imports" class="h-14 w-auto" />
    </div>

    <nav class="hidden lg:flex space-x-2 items-center">
      {navLinks.map(({ href, label, icon: Icon }) => (
        <a
          href={href}
          class="nav-link px-3 py-2 rounded-xl text-sm font-medium flex items-center gap-1 
                 transition-all duration-200 hover:bg-[#002f6c]/10 hover:text-[#002f6c]"
        >
          <Icon size={18} style="color: #002f6c" />
          {label}
        </a>
      ))}
    </nav>

    <div class="lg:hidden dropdown dropdown-end">
      <label tabindex="0" class="btn btn-ghost">
        <Menu size={24} />
      </label>
      <ul
        tabindex="0"
        class="menu menu-sm dropdown-content mt-3 z-[100] p-2 shadow bg-white rounded-box w-52"
      >
        {navLinks.map(({ href, label, icon: Icon }) => (
          <li>
            <a
              href={href}
              class="nav-link flex items-center gap-2 px-2 py-2 rounded-lg transition-all duration-200 
                     hover:bg-[#002f6c]/10 hover:text-[#002f6c]"
            >
              <Icon size={18} style="color: #002f6c" />
              {label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('section[id]');

    function setActiveLink(href) {
      navLinks.forEach((link) => {
        const isActive = link.getAttribute('href') === href;
        link.classList.toggle('bg-[#002f6c]/10', isActive);
        link.classList.toggle('text-[#002f6c]', isActive);
        link.classList.toggle('font-semibold', isActive);
        link.classList.toggle('shadow-md', isActive);
      });
    }

    const hash = window.location.hash;
    if (hash) {
      setActiveLink(hash);
      const target = document.querySelector(hash);
      if (target) {
        setTimeout(() => {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 400);
      }
    } else {
      setActiveLink('#inicio');
    }

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            setActiveLink(`#${id}`);
            history.replaceState(null, '', `#${id}`);
          }
        });
      },
      { threshold: 0.4 }
    );

    sections.forEach((section) => observer.observe(section));
    
    navLinks.forEach((link) => {
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        if (href.startsWith('#')) {
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            history.replaceState(null, '', href);
            setActiveLink(href);
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      });
    });
  });
</script>
